<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Achievements & Badges</title>
<style>
  body { font-family: Arial; background:#f4f6fb; margin:0; color:#1A2A80; }
  header { background:#1A2A80; color:#fff; padding:20px; text-align:center; }
  .container { max-width:800px; margin:auto; padding:20px; }
  .form { background:#fff; padding:20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); margin-bottom:20px; }
  input, textarea { width:100%; padding:10px; margin:8px 0; border:1px solid #ccc; border-radius:8px; }
  button { background:#3B38A0; color:#fff; border:none; padding:10px 16px; border-radius:8px; cursor:pointer; }
  button:hover { background:#1A2A80; }
  .cards { display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:15px; }
  .card { background:#fff; padding:15px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
  .card h3 { margin:0; color:#1A2A80; }
  .card p { margin:5px 0; }
  .approved { color:green; font-weight:bold; }
  .pending { color:orange; font-weight:bold; }
</style>
</head>
<body>
<header>
  <h1>Achievements & Badges</h1>
</header>

<div class="container">
  <div class="form">
    <h2>Add Achievement</h2>
    <input type="text" id="achTitle" placeholder="Achievement Title">
    <textarea id="achDesc" placeholder="Description"></textarea>
    <button id="addAchievementBtn">Add Achievement</button>
  </div>

  <h2>Your Achievements</h2>
  <div id="achievementsList" class="cards"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
      apiKey: "AIzaSyCBfr5gR5pihZoSTvId8E5Ty_5RCL5MYhw",
      authDomain: "auth-demo-37f58.firebaseapp.com",
      projectId: "auth-demo-37f58",
      storageBucket: "auth-demo-37f58.firebasestorage.app",
      messagingSenderId: "799076361553",
      appId: "1:799076361553:web:6ff356a4d894a27cfb9f70",
      measurementId: "G-RPZBW0SCK5"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser = null;
const achievementsList = document.getElementById("achievementsList");

onAuthStateChanged(auth, user=>{
  if(!user){
    alert("Please login!");
    window.location.href = "loginPage.html";
    return;
  }
  currentUser = user;
  loadAchievements();
});

// ---------------- Add Achievement ----------------
document.getElementById("addAchievementBtn").addEventListener("click", async ()=>{
  const title = document.getElementById("achTitle").value.trim();
  const desc = document.getElementById("achDesc").value.trim();

  if(!title){ alert("Enter achievement title"); return; }

  try{
    await addDoc(collection(db, "users", currentUser.uid, "achievements"), {
      title, description: desc, approved: false, timestamp: new Date()
    });
    document.getElementById("achTitle").value = "";
    document.getElementById("achDesc").value = "";
    loadAchievements();
  }catch(err){
    console.error(err);
    alert("Error saving achievement");
  }
});

// ---------------- Load Achievements ----------------
async function loadAchievements(){
  achievementsList.innerHTML = "";
  const snapshot = await getDocs(collection(db, "users", currentUser.uid, "achievements"));
  if(snapshot.empty){
    achievementsList.innerHTML = "<p style='text-align:center;'>No achievements added yet</p>";
    return;
  }
  snapshot.forEach(docSnap=>{
    const a = docSnap.data();
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <h3>${a.title}</h3>
      <p>${a.description}</p>
      <p>Status: <span class="${a.approved ? 'approved' : 'pending'}">${a.approved ? 'Approved ✅' : 'Pending ⏳'}</span></p>
    `;
    achievementsList.appendChild(card);
  });
}
</script>
</body>
</html>
